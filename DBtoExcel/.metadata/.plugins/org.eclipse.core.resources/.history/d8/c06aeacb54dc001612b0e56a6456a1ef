import java.io.IOException;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;

public class DBtoExcel {

	private static String database;
	private static String[] data;
	private static String[] colNames;
	
	private static DBHelper dbhelper;
	private static Connection conn;
	private static ResultSet rs;
	
	private static POIHelper poi;
	
	public static void main(String[] args) throws SQLException, IOException {
		// TODO Auto-generated method stub
		
		database = "hw1";
		dbhelper = new DBHelper();
		poi = new POIHelper("C:/Users/njraf_000/Desktop/"+database+".xlsx");
		
		conn = dbhelper.connect(database, "root", "");
		createSheets();
		
		
		dbhelper.close();
		poi.close();
	}
	
	public static void createSheets() throws SQLException, IOException {
		rs = dbhelper.query(conn, "SHOW TABLES");
		
		while(rs.next()) {
			poi.createSheet(rs.getString(1)); //create named sheet
			System.out.println("col: "+rs.getString(1));
			copyTable(rs.getString(1));
		}
	}
	
	public static void copyTable(String table) throws SQLException, IOException {
		rs = dbhelper.query(conn, "SELECT * FROM "+table);
		int cols = rs.getMetaData().getColumnCount();
		
		data = new String[cols];
		
		//column names
		poi.writeRow(dbhelper.getColumnNames());
		
		//table data
		int rows = dbhelper.getNumRows();
		for(int a = 0; a < rows; a++) {
			poi.writeRow(dbhelper.getRow());
		}
		
		
	}

}
